var xe=Object.defineProperty;var Ce=(c,s,e)=>s in c?xe(c,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):c[s]=e;var N=(c,s,e)=>(Ce(c,typeof s!="symbol"?s+"":s,e),e);import{s as ke,n as pe,r as Ee,o as ue,e as Le}from"../chunks/scheduler.BCVBOh_d.js";import{S as Te,i as ze,e as m,s as I,j as X,q as ve,c as _,b as T,d as b,a as D,g as Z,k as q,n as y,f as Q,l as n,o as re,m as ae,p as Oe,B as ge}from"../chunks/index.DTdc6F5z.js";import{e as me}from"../chunks/each.D6YF6ztN.js";import{w as Se}from"../chunks/index.GezKuID8.js";const Re=11,_e=20;class ce{constructor(s){N(this,"x");N(this,"y");N(this,"color");N(this,"shape");N(this,"ctx");N(this,"BLOCKS",[[[0,0,2,0],[0,0,2,0],[0,0,2,0],[0,0,2,0]],[[2,2,2],[0,2,0],[0,0,0]],[[2,0,0],[2,0,0],[2,2,0]],[[0,0,2],[0,0,2],[0,2,2]],[[0,2,2],[0,2,2],[0,0,0]],[[2,2,0],[0,2,2],[0,0,0]],[[0,2,2],[2,2,0],[0,0,0]]]);N(this,"COLORS",["cyan","blue","orange","yellow","green","purple","red"]);this.ctx=s,this.spawn()}randomizeType(s){return Math.floor(Math.random()*s)}spawn(){const s=this.randomizeType(this.COLORS.length);this.color=this.COLORS[s],this.shape=this.BLOCKS[s],this.x=3,this.y=0}draw(){this.ctx.fillStyle=this.color,this.shape.forEach((s,e)=>{s.forEach((r,h)=>{r>0&&this.ctx.fillRect(this.x+h,this.y+e,1,1)})})}collision(s){for(let e=0;e<this.shape.length;e++)for(let r=0;r<this.shape[e].length;r++)if(this.shape[e][r]>0){let h=this.x+r,a=this.y+e;if(h<0||h>=Re||a>=_e)return!0;if(a<_e){let t=s.grid[a][h];if(t!==0&&(typeof t=="object"?t.value:t)>0)return!0}}return!1}moveLeft(s){this.x--,this.collision(s)&&this.x++}moveRight(s){this.x++,this.collision(s)&&this.x--}moveDown(s){return this.y++,this.collision(s)?(this.y--,!0):!1}moveBottom(s){for(;!this.collision(s);)this.y++;return this.y--,!0}rotate(s){let e=this.shape.map(t=>[...t]),r=e.length;for(let t=0;t<r;t++)for(let l=0;l<t;l++)[e[l][t],e[t][l]]=[e[t][l],e[l][t]];e.forEach(t=>t.reverse());let h=this.x,a=this.y;if(this.shape=e,this.collision(s)){this.shape=e.map(t=>[...t]).reverse().map(t=>t.reverse());for(let t=0;t<r;t++)for(let l=0;l<r/2;l++)[this.shape[t][l],this.shape[t][r-1-l]]=[this.shape[t][r-1-l],this.shape[t][l]];this.x=h,this.y=a}}reverseRotate(s){let e=this.shape.map(t=>[...t]),r=e.length;for(let t=0;t<r;t++)for(let l=0;l<t;l++)[e[l][t],e[t][l]]=[e[t][l],e[l][t]];for(let t=0;t<r;t++)for(let l=0;l<r/2;l++)[e[l][t],e[r-1-l][t]]=[e[r-1-l][t],e[l][t]];let h=this.x,a=this.y;if(this.shape=e,this.collision(s)){this.shape=e.map(t=>[...t]).reverse().map(t=>t.reverse());for(let t=0;t<r;t++)for(let l=0;l<r/2;l++)[this.shape[t][l],this.shape[t][r-1-l]]=[this.shape[t][r-1-l],this.shape[t][l]];this.x=h,this.y=a}}lock(s){this.shape.forEach((e,r)=>{e.forEach((h,a)=>{h>0&&(s.grid[this.y+r][this.x+a]={value:h,color:this.color})})})}}let te=Se(0),G=Se(1);function be(c,s,e){const r=c.slice();return r[5]=s[e].nickname,r[19]=s[e].score,r[21]=e,r}function ye(c){let s,e,r=c[21]+1+"",h,a,t,l=c[5]+"",u,d,S,z=c[19]+"",L,M;return{c(){s=m("tr"),e=m("td"),h=X(r),a=I(),t=m("td"),u=X(l),d=I(),S=m("td"),L=X(z),M=I(),this.h()},l(C){s=_(C,"TR",{class:!0});var f=T(s);e=_(f,"TD",{class:!0});var O=T(e);h=q(O,r),O.forEach(b),a=D(f),t=_(f,"TD",{class:!0});var V=T(t);u=q(V,l),V.forEach(b),d=D(f),S=_(f,"TD",{class:!0});var P=T(S);L=q(P,z),P.forEach(b),M=D(f),f.forEach(b),this.h()},h(){y(e,"class","svelte-14pz0gn"),y(t,"class","svelte-14pz0gn"),y(S,"class","svelte-14pz0gn"),y(s,"class","svelte-14pz0gn")},m(C,f){Q(C,s,f),n(s,e),n(e,h),n(s,a),n(s,t),n(t,u),n(s,d),n(s,S),n(S,L),n(s,M)},p(C,f){f&8&&l!==(l=C[5]+"")&&ae(u,l),f&8&&z!==(z=C[19]+"")&&ae(L,z)},d(C){C&&b(s)}}}function we(c){let s,e,r,h,a="점수 제출",t,l;return{c(){s=m("div"),e=m("input"),r=I(),h=m("button"),h.textContent=a,this.h()},l(u){s=_(u,"DIV",{class:!0});var d=T(s);e=_(d,"INPUT",{placeholder:!0}),r=D(d),h=_(d,"BUTTON",{class:!0,"data-svelte-h":!0}),Z(h)!=="svelte-bny16c"&&(h.textContent=a),d.forEach(b),this.h()},h(){y(e,"placeholder","닉네임 입력"),y(h,"class","svelte-14pz0gn"),y(s,"class","modal svelte-14pz0gn")},m(u,d){Q(u,s,d),n(s,e),ge(e,c[5]),n(s,r),n(s,h),t||(l=[re(e,"input",c[10]),re(h,"click",c[6])],t=!0)},p(u,d){d&32&&e.value!==u[5]&&ge(e,u[5])},d(u){u&&b(s),t=!1,Ee(l)}}}function Be(c){let s,e,r,h,a,t,l="Start",u,d,S="Stop",z,L,M,C,f,O,V,P,W,j,$=`← → : 좌우 이동
            <br/>
            ↑ : 시계 회전
            <br/>
            Ctrl : 반시계 회전
            <br/>
            Shift : 떨어뜨리기`,o,i,R,k,H='<tr class="svelte-14pz0gn"><th class="svelte-14pz0gn">순위</th> <th class="svelte-14pz0gn">닉네임</th> <th class="svelte-14pz0gn">점수</th></tr>',U,v,Y,A,J,he,F=me(c[3]),w=[];for(let p=0;p<F.length;p+=1)w[p]=ye(be(c,F,p));let x=c[4]&&we(c);return{c(){s=m("div"),e=m("div"),r=m("canvas"),h=I(),a=m("div"),t=m("button"),t.textContent=l,u=I(),d=m("button"),d.textContent=S,z=I(),L=m("p"),M=X("점수: "),C=X(c[1]),f=I(),O=m("p"),V=X("레벨: "),P=X(c[2]),W=I(),j=m("p"),j.innerHTML=$,o=I(),i=m("div"),R=m("table"),k=m("thead"),k.innerHTML=H,U=I(),v=m("tbody");for(let p=0;p<w.length;p+=1)w[p].c();Y=I(),x&&x.c(),A=ve(),this.h()},l(p){s=_(p,"DIV",{class:!0});var E=T(s);e=_(E,"DIV",{class:!0});var g=T(e);r=_(g,"CANVAS",{class:!0}),T(r).forEach(b),g.forEach(b),h=D(E),a=_(E,"DIV",{class:!0});var B=T(a);t=_(B,"BUTTON",{class:!0,"data-svelte-h":!0}),Z(t)!=="svelte-1ofsci"&&(t.textContent=l),u=D(B),d=_(B,"BUTTON",{class:!0,"data-svelte-h":!0}),Z(d)!=="svelte-v5vx3a"&&(d.textContent=S),z=D(B),L=_(B,"P",{class:!0});var oe=T(L);M=q(oe,"점수: "),C=q(oe,c[1]),oe.forEach(b),f=D(B),O=_(B,"P",{class:!0});var ne=T(O);V=q(ne,"레벨: "),P=q(ne,c[2]),ne.forEach(b),W=D(B),j=_(B,"P",{class:!0,"data-svelte-h":!0}),Z(j)!=="svelte-1pj4t5w"&&(j.innerHTML=$),B.forEach(b),o=D(E),i=_(E,"DIV",{class:!0});var fe=T(i);R=_(fe,"TABLE",{class:!0});var ee=T(R);k=_(ee,"THEAD",{"data-svelte-h":!0}),Z(k)!=="svelte-1prna21"&&(k.innerHTML=H),U=D(ee),v=_(ee,"TBODY",{});var de=T(v);for(let ie=0;ie<w.length;ie+=1)w[ie].l(de);de.forEach(b),ee.forEach(b),fe.forEach(b),E.forEach(b),Y=D(p),x&&x.l(p),A=ve(),this.h()},h(){y(r,"class","play-board svelte-14pz0gn"),y(e,"class","play-division svelte-14pz0gn"),y(t,"class","svelte-14pz0gn"),y(d,"class","svelte-14pz0gn"),y(L,"class","svelte-14pz0gn"),y(O,"class","svelte-14pz0gn"),y(j,"class","svelte-14pz0gn"),y(a,"class","right-division svelte-14pz0gn"),y(R,"class","leaderboard svelte-14pz0gn"),y(i,"class","leaderboard-container"),y(s,"class","board svelte-14pz0gn")},m(p,E){Q(p,s,E),n(s,e),n(e,r),c[9](r),n(s,h),n(s,a),n(a,t),n(a,u),n(a,d),n(a,z),n(a,L),n(L,M),n(L,C),n(a,f),n(a,O),n(O,V),n(O,P),n(a,W),n(a,j),n(s,o),n(s,i),n(i,R),n(R,k),n(R,U),n(R,v);for(let g=0;g<w.length;g+=1)w[g]&&w[g].m(v,null);Q(p,Y,E),x&&x.m(p,E),Q(p,A,E),J||(he=[re(t,"click",c[8]),re(d,"click",c[7])],J=!0)},p(p,[E]){if(E&2&&ae(C,p[1]),E&4&&ae(P,p[2]),E&8){F=me(p[3]);let g;for(g=0;g<F.length;g+=1){const B=be(p,F,g);w[g]?w[g].p(B,E):(w[g]=ye(B),w[g].c(),w[g].m(v,null))}for(;g<w.length;g+=1)w[g].d(1);w.length=F.length}p[4]?x?x.p(p,E):(x=we(p),x.c(),x.m(A.parentNode,A)):x&&(x.d(1),x=null)},i:pe,o:pe,d(p){p&&(b(s),b(Y),b(A)),c[9](null),Oe(w,p),x&&x.d(p),J=!1,Ee(he)}}}const se=11,le=20,K=35;function Ie(){window.location.reload()}function De(c,s){fetch("/api/score",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({nickname:c,score:s})}).then(e=>{if(!e.ok)throw new Error("점수 제출 실패");return e.json()}).then(e=>{console.log("점수 제출 성공:",e),Ie()})}function Ae(c,s,e){let r,h,a,t=1e3,l=0,u=[],d,S="",z=!1;te.subscribe(o=>e(1,h=o)),G.subscribe(o=>e(2,a=o));function L(o){te.update(i=>i+o)}function M(o){for(l+=o;l>=10;)l-=10,G.update(i=>i+1)}class C{constructor(){N(this,"grid");this.reset()}reset(){this.grid=this.getEmptyBoard()}removeLines(){let i=[];for(let k=0;k<le;k++)this.grid[k].every(U=>U.value>0)&&i.push(k);i.forEach(k=>{this.grid.splice(k,1),this.grid.unshift(Array(se).fill(0))});let R=i.length;return l+=R,l>=10&&(console.log("clearLine >= 10"),M()),console.log(a+" "+l),i.length*i.length*100}getEmptyBoard(){return Array.from({length:le},()=>Array(se).fill(0))}}let f=new C;function O(){clearInterval(d),e(4,z=!0)}function V(){if(!S.trim()){alert("닉네임을 입력해야 점수를 제출할 수 있습니다.");return}De(S,h),e(4,z=!1),e(5,S="")}function P(){r.getContext("2d").clearRect(0,0,r.width,r.height),f.reset(),d&&clearInterval(d),te.set(0),G.set(1)}function W(){f.reset(),te.set(0),G.set(1);const o=r.getContext("2d");o.canvas.width=se*K,o.canvas.height=le*K,o.scale(K,K);let i=new ce(o);if(i.collision(f)){O();return}i.draw();function R(){o.clearRect(0,0,o.canvas.width,o.canvas.height),i.draw(),k();for(let v=0;v<10;v++)f.grid[0][v]===2&&alert("게임오버")}function k(){f.grid.forEach((v,Y)=>{v.forEach((A,J)=>{typeof A=="object"&&A.value>0&&(o.fillStyle=A.color,o.fillRect(J,Y,1,1))})})}function H(){if(i.moveDown(f)){if(i.lock(f),f.grid[0].some(Y=>Y!==0)){O();return}i=new ce(o)}i.moveDown(f)&&(i.lock(f),i=new ce(o));const v=f.removeLines();L(v),R()}function U(){G.subscribe(v=>{e(2,a=v),t=Math.max(200,1e3-a*100),d&&clearInterval(d),d=setInterval(H,t)})}U(),G.subscribe(v=>{e(2,a=v),U()}),document.addEventListener("keydown",function(v){switch(v.key){case"ArrowLeft":i.moveLeft(f);break;case"ArrowRight":i.moveRight(f);break;case"ArrowDown":H();break;case"ArrowUp":i.rotate(f);break;case"Shift":i.moveBottom(f),H();break;case"Control":i.reverseRotate(f);break}R()}),d&&clearInterval(d),d=setInterval(H,t)}ue(()=>{const o=r.getContext("2d");o.canvas.width=se*K,o.canvas.height=le*K,o.scale(K,K)}),ue(async()=>{try{const o=await fetch("/api/leaderBoard",{method:"POST"});if(!o.ok)throw new Error("리더보드 호출 실패");const i=await o.json();e(3,u=i),console.log("리더보드 호출 성공:",i)}catch(o){console.error("리더보드 호출 중 오류 발생:",o)}});function j(o){Le[o?"unshift":"push"](()=>{r=o,e(0,r)})}function $(){S=this.value,e(5,S)}return[r,h,a,u,z,S,V,P,W,j,$]}class He extends Te{constructor(s){super(),ze(this,s,Ae,Be,ke,{})}}export{He as component};
