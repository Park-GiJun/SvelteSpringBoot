var ze=Object.defineProperty;var Ke=(c,t,e)=>t in c?ze(c,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):c[t]=e;var K=(c,t,e)=>(Ke(c,typeof t!="symbol"?t+"":t,e),e);import{s as je,n as Ce,r as Me,o as Le,f as Ue,e as Oe}from"../chunks/scheduler.LC6wQ9wn.js";import{S as He,i as We,e as u,s as D,m as j,q as Re,c as p,b as S,d,a as N,n as U,g as de,j as x,f as oe,o,l as ne,p as le,r as Ge,k as Te}from"../chunks/index.DkeaYaFh.js";import{e as Be}from"../chunks/each.D6YF6ztN.js";import{w as Ve}from"../chunks/index.3rQHIXWG.js";const Xe=11,Ie=25;class Ae{constructor(t,e){K(this,"x");K(this,"y");K(this,"color");K(this,"shape");K(this,"ctx");K(this,"ctx2");K(this,"BLOCKS",[[[0,2,0,0],[0,2,0,0],[0,2,0,0],[0,2,0,0]],[[0,2,0],[2,2,2],[0,0,0]],[[0,2,0],[0,2,0],[0,2,2]],[[0,2,0],[0,2,0],[2,2,0]],[[2,2],[2,2]],[[2,2,0],[0,2,2],[0,0,0]],[[0,2,2],[2,2,0],[0,0,0]]]);K(this,"COLORS",["cyan","blue","orange","yellow","green","purple","red"]);K(this,"nextPiece",null);this.ctx=t,this.ctx2=e,this.spawn()}randomizeType(t){return Math.floor(Math.random()*t)}spawn(){const t=this.randomizeType(this.COLORS.length);this.color=this.COLORS[t],this.shape=this.BLOCKS[t],this.x=4,this.y=0,this.spawnNextBlock()}spawnNextBlock(){const t=this.randomizeType(this.COLORS.length);this.color=this.COLORS[t],this.shape=this.BLOCKS[t],this.x=4,this.y=0}drawNextBlock(t){t.clearRect(0,0,t.canvas.width,t.canvas.height),t.fillStyle=this.color,this.shape.forEach((e,a)=>{e.forEach((h,r)=>{if(h>0){t.fillRect(r,a,1,1),this.ctx.strokeStyle="BLACK",this.ctx.lineWidth=.009,this.ctx.zIndex=10;for(let l=0;l<1;l+=1)for(let s=0;s<1;s+=1)this.ctx.strokeRect(this.x+r+l,this.y+a+s,1,1)}})})}draw(){this.ctx.fillStyle=this.color,this.shape.forEach((t,e)=>{t.forEach((a,h)=>{if(a>0){this.ctx.fillRect(this.x+h,this.y+e,1,1),this.ctx.strokeStyle="BLACK",this.ctx.lineWidth=.009,this.ctx.zIndex=10;for(let r=0;r<1;r+=1)for(let l=0;l<1;l+=1)this.ctx.strokeRect(this.x+h+r,this.y+e+l,1,1)}})})}collision(t){for(let e=0;e<this.shape.length;e++)for(let a=0;a<this.shape[e].length;a++)if(this.shape[e][a]>0){let h=this.x+a,r=this.y+e;if(h<0||h>=Xe||r>=Ie)return!0;if(r<Ie){let l=t.grid[r][h];if(l!==0&&(typeof l=="object"?l.value:l)>0)return!0}}return!1}moveLeft(t){this.x--,this.collision(t)&&this.x++}moveRight(t){this.x++,this.collision(t)&&this.x--}moveDown(t){return this.y++,this.collision(t)?(this.y--,!0):!1}moveBottom(t){for(;!this.collision(t);)this.y++;return this.y--,!0}rotate(t){let e=this.shape.map(l=>[...l]),a=e.length;for(let l=0;l<a;l++)for(let s=0;s<l;s++)[e[s][l],e[l][s]]=[e[l][s],e[s][l]];e.forEach(l=>l.reverse());let h=this.x,r=this.y;if(this.shape=e,this.collision(t)){let l=!1;for(let s=-1;s<=1;s++){if(this.x+=s,!this.collision(t)){l=!0;break}this.x=h}if(!l){this.shape=this.shape.map(s=>[...s]).reverse().map(s=>s.reverse());for(let s=0;s<a;s++)for(let n=0;n<a/2;n++)[this.shape[s][n],this.shape[s][a-1-n]]=[this.shape[s][a-1-n],this.shape[s][n]];this.x=h,this.y=r}}}reverseRotate(t){let e=this.shape.map(l=>[...l]),a=e.length;e.forEach(l=>l.reverse());for(let l=0;l<a;l++)for(let s=0;s<l;s++)[e[s][l],e[l][s]]=[e[l][s],e[s][l]];let h=this.x,r=this.y;if(this.shape=e,this.collision(t)){let l=!1;for(let s=-1;s<=1;s++){if(this.x+=s,!this.collision(t)){l=!0;break}this.x=h}if(!l){this.shape.forEach(s=>s.reverse());for(let s=0;s<a;s++)for(let n=0;n<s;n++)[this.shape[n][s],this.shape[s][n]]=[this.shape[s][n],this.shape[n][s]];this.shape.forEach(s=>s.reverse()),this.x=h,this.y=r}}}lock(t){this.shape.forEach((e,a)=>{e.forEach((h,r)=>{h>0&&(t.grid[this.y+a][this.x+r]={value:h,color:this.color})})})}}let he=Ve(0),se=Ve(1);function De(c,t,e){const a=c.slice();return a[8]=t[e].nickname,a[23]=t[e].score,a[25]=e,a}function Ne(c){let t,e,a=c[25]+1+"",h,r,l,s=c[8]+"",n,P,f,C=c[23]+"",_,m;return{c(){t=u("tr"),e=u("td"),h=j(a),r=D(),l=u("td"),n=j(s),P=D(),f=u("td"),_=j(C),m=D(),this.h()},l(w){t=p(w,"TR",{class:!0});var L=S(t);e=p(L,"TD",{class:!0});var Y=S(e);h=U(Y,a),Y.forEach(d),r=N(L),l=p(L,"TD",{class:!0});var M=S(l);n=U(M,s),M.forEach(d),P=N(L),f=p(L,"TD",{class:!0});var b=S(f);_=U(b,C),b.forEach(d),m=N(L),L.forEach(d),this.h()},h(){x(e,"class","svelte-12x5mv6"),x(l,"class","svelte-12x5mv6"),x(f,"class","svelte-12x5mv6"),x(t,"class","svelte-12x5mv6")},m(w,L){oe(w,t,L),o(t,e),o(e,h),o(t,r),o(t,l),o(l,n),o(t,P),o(t,f),o(f,_),o(t,m)},p(w,L){L&32&&s!==(s=w[8]+"")&&le(n,s),L&32&&C!==(C=w[23]+"")&&le(_,C)},d(w){w&&d(t)}}}function Pe(c){let t,e,a,h,r,l="점수 제출",s,n,P="취소",f,C;return{c(){t=u("div"),e=u("div"),a=u("input"),h=D(),r=u("button"),r.textContent=l,s=D(),n=u("button"),n.textContent=P,this.h()},l(_){t=p(_,"DIV",{class:!0});var m=S(t);e=p(m,"DIV",{class:!0});var w=S(e);a=p(w,"INPUT",{placeholder:!0}),h=N(w),r=p(w,"BUTTON",{class:!0,"data-svelte-h":!0}),de(r)!=="svelte-bny16c"&&(r.textContent=l),s=N(w),n=p(w,"BUTTON",{class:!0,"data-svelte-h":!0}),de(n)!=="svelte-1xig66l"&&(n.textContent=P),w.forEach(d),m.forEach(d),this.h()},h(){x(a,"placeholder","닉네임 입력"),x(r,"class","svelte-12x5mv6"),x(n,"class","svelte-12x5mv6"),x(e,"class","modal svelte-12x5mv6"),x(t,"class","overlay svelte-12x5mv6")},m(_,m){oe(_,t,m),o(t,e),o(e,a),Te(a,c[8]),o(e,h),o(e,r),o(e,s),o(e,n),f||(C=[ne(a,"input",c[14]),ne(r,"click",c[10]),ne(n,"click",_e)],f=!0)},p(_,m){m&256&&a.value!==_[8]&&Te(a,_[8])},d(_){_&&d(t),f=!1,Me(C)}}}function Ye(c){let t,e,a,h,r,l,s=c[7]?"Reset":"Start",n,P,f,C,_,m,w,L,Y,M,b,F,ae,V,re,Z=c[4]+(c[3]-1)*10+"",J,ie,i,y=`← → : 좌우 이동
			<br/>
			↑ : 시계 회전
			<br/>
			X : 반시계 회전
			<br/>
			Z : 떨어뜨리기`,O,B,G,H,X,g,z,Q='<tr class="svelte-12x5mv6"><th class="svelte-12x5mv6">순위</th> <th class="svelte-12x5mv6">닉네임</th> <th class="svelte-12x5mv6">점수</th></tr>',$,W,q,ee,ue,be,te=Be(c[5]),R=[];for(let v=0;v<te.length;v+=1)R[v]=Ne(De(c,te,v));let I=c[6]&&Pe(c);return{c(){t=u("div"),e=u("div"),a=u("canvas"),h=D(),r=u("div"),l=u("button"),n=j(s),P=D(),f=u("button"),C=j("Stop"),_=D(),m=u("p"),w=j("점수: "),L=j(c[2]),Y=D(),M=u("p"),b=j("레벨: "),F=j(c[3]),ae=D(),V=u("p"),re=j("제거한 줄 : "),J=j(Z),ie=D(),i=u("p"),i.innerHTML=y,O=D(),B=u("div"),G=u("canvas"),H=D(),X=u("div"),g=u("table"),z=u("thead"),z.innerHTML=Q,$=D(),W=u("tbody");for(let v=0;v<R.length;v+=1)R[v].c();q=D(),I&&I.c(),ee=Re(),this.h()},l(v){t=p(v,"DIV",{class:!0});var k=S(t);e=p(k,"DIV",{class:!0});var E=S(e);a=p(E,"CANVAS",{class:!0}),S(a).forEach(d),E.forEach(d),h=N(k),r=p(k,"DIV",{class:!0});var T=S(r);l=p(T,"BUTTON",{class:!0});var ye=S(l);n=U(ye,s),ye.forEach(d),P=N(T),f=p(T,"BUTTON",{class:!0});var we=S(f);C=U(we,"Stop"),we.forEach(d),_=N(T),m=p(T,"P",{class:!0});var pe=S(m);w=U(pe,"점수: "),L=U(pe,c[2]),pe.forEach(d),Y=N(T),M=p(T,"P",{class:!0});var me=S(M);b=U(me,"레벨: "),F=U(me,c[3]),me.forEach(d),ae=N(T),V=p(T,"P",{class:!0});var ge=S(V);re=U(ge,"제거한 줄 : "),J=U(ge,Z),ge.forEach(d),ie=N(T),i=p(T,"P",{class:!0,"data-svelte-h":!0}),de(i)!=="svelte-12plnba"&&(i.innerHTML=y),O=N(T),B=p(T,"DIV",{class:!0});var ke=S(B);G=p(ke,"CANVAS",{class:!0}),S(G).forEach(d),ke.forEach(d),T.forEach(d),H=N(k),X=p(k,"DIV",{class:!0});var Ee=S(X);g=p(Ee,"TABLE",{class:!0});var ce=S(g);z=p(ce,"THEAD",{"data-svelte-h":!0}),de(z)!=="svelte-e1zn3c"&&(z.innerHTML=Q),$=N(ce),W=p(ce,"TBODY",{});var Se=S(W);for(let xe=0;xe<R.length;xe+=1)R[xe].l(Se);Se.forEach(d),ce.forEach(d),Ee.forEach(d),k.forEach(d),q=N(v),I&&I.l(v),ee=Re(),this.h()},h(){x(a,"class","play-board svelte-12x5mv6"),x(e,"class","play-division svelte-12x5mv6"),x(l,"class","svelte-12x5mv6"),f.disabled=c[6],x(f,"class","svelte-12x5mv6"),x(m,"class","svelte-12x5mv6"),x(M,"class","svelte-12x5mv6"),x(V,"class","svelte-12x5mv6"),x(i,"class","svelte-12x5mv6"),x(G,"class","next-block svelte-12x5mv6"),x(B,"class","next-block-division"),x(r,"class","right-division svelte-12x5mv6"),x(g,"class","leaderboard svelte-12x5mv6"),x(X,"class","leaderboard-container"),x(t,"class","board svelte-12x5mv6")},m(v,k){oe(v,t,k),o(t,e),o(e,a),c[12](a),o(t,h),o(t,r),o(r,l),o(l,n),o(r,P),o(r,f),o(f,C),o(r,_),o(r,m),o(m,w),o(m,L),o(r,Y),o(r,M),o(M,b),o(M,F),o(r,ae),o(r,V),o(V,re),o(V,J),o(r,ie),o(r,i),o(r,O),o(r,B),o(B,G),c[13](G),o(t,H),o(t,X),o(X,g),o(g,z),o(g,$),o(g,W);for(let E=0;E<R.length;E+=1)R[E]&&R[E].m(W,null);oe(v,q,k),I&&I.m(v,k),oe(v,ee,k),ue||(be=[ne(l,"click",c[9]),ne(f,"click",c[11])],ue=!0)},p(v,[k]){if(k&128&&s!==(s=v[7]?"Reset":"Start")&&le(n,s),k&64&&(f.disabled=v[6]),k&4&&le(L,v[2]),k&8&&le(F,v[3]),k&24&&Z!==(Z=v[4]+(v[3]-1)*10+"")&&le(J,Z),k&32){te=Be(v[5]);let E;for(E=0;E<te.length;E+=1){const T=De(v,te,E);R[E]?R[E].p(T,k):(R[E]=Ne(T),R[E].c(),R[E].m(W,null))}for(;E<R.length;E+=1)R[E].d(1);R.length=te.length}v[6]?I?I.p(v,k):(I=Pe(v),I.c(),I.m(ee.parentNode,ee)):I&&(I.d(1),I=null)},i:Ce,o:Ce,d(v){v&&(d(t),d(q),d(ee)),c[12](null),c[13](null),Ge(R,v),I&&I.d(v),ue=!1,Me(be)}}}const fe=11,ve=25,A=30;function _e(){window.location.reload()}function qe(){window.location.reload()}function Fe(c,t){fetch("/api/score",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({nickname:c,score:t})}).then(e=>{if(!e.ok)throw new Error("점수 제출 실패");return e.json()}).then(e=>{console.log("점수 제출 성공:",e),qe(),window.location.href="./TetrisCanvas"})}function Ze(c,t,e){let a,h;Le(()=>{const i=a.getContext("2d");i.canvas.width=fe*A,i.canvas.height=ve*A,i.scale(A,A);const y=h.getContext("2d");y.canvas.width=3*A,y.canvas.height=4*A,y.scale(A,A)});let r,l,s=800,n=0,P=[],f,C="",_=!1,m=!1;he.subscribe(i=>e(2,r=i)),se.subscribe(i=>e(3,l=i));function w(){m?V():re()}function L(i){he.update(y=>y+i)}function Y(){se.update(i=>i+1)}class M{constructor(){K(this,"grid");this.reset()}reset(){this.grid=this.getEmptyBoard()}removeLines(){let y=[];for(let B=0;B<ve;B++)this.grid[B].every(H=>H.value>0)&&y.push(B);y.forEach(B=>{this.grid.splice(B,1),this.grid.unshift(Array(fe).fill(0))});let O=y.length;return e(4,n+=O),n>=10&&(e(4,n-=10),Y()),console.log(l+" "+n),y.length*y.length*100*l}getEmptyBoard(){return Array.from({length:ve},()=>Array(fe).fill(0))}}let b=new M;function F(){clearInterval(f),e(6,_=!0)}function ae(){if(!C.trim()){alert("닉네임을 입력해야 점수를 제출할 수 있습니다.");return}Fe(C,r),e(6,_=!1),e(8,C=""),_e()}function V(){if(e(7,m=!1),!a){console.error("Canvas 엘리먼트가 초기화되지 않았습니다.");return}const i=a.getContext("2d");i.clearRect(0,0,a.width,a.height),i.beginPath(),b.reset(),f&&(clearInterval(f),f=null),e(4,n=0),he.set(0),se.set(1),_e()}function re(){e(7,m=!0),f&&clearInterval(f),b.reset(),e(4,n=0),he.set(0),se.set(1);const i=a.getContext("2d");i.canvas.width=fe*A,i.canvas.height=ve*A,i.scale(A,A);const y=h.getContext("2d");y.canvas.width=3*A,y.canvas.height=4*A,y.scale(A,A);let O=new Ae(i);if(O.collision(b)){F();return}O.draw(),O.drawNextBlock(y);function B(){i.clearRect(0,0,i.canvas.width,i.canvas.height),i.beginPath(),O.draw(),G();for(let g=0;g<10;g++)b.grid[0][g]===2&&alert("게임오버")}function G(){b.grid.forEach((g,z)=>{g.forEach((Q,$)=>{if(typeof Q=="object"&&Q.value>0){i.fillStyle=Q.color,i.fillRect($,z,1,1),i.strokeStyle="BLACK",i.lineWidth=.01;for(let W=0;W<1;W+=1)for(let q=0;q<1;q+=1)i.strokeRect($+W,z+q,1,1)}})})}function H(){if(O.moveDown(b)){if(O.lock(b),console.table(b.grid),b.grid[0].some(z=>z!==0)){F();return}O=new Ae(i)}const g=b.removeLines();L(g),B(),X()}function X(){se.subscribe(g=>{e(3,l=g),s=Math.max(200,s-l*100),f&&clearInterval(f),f=setInterval(H,s)})}se.subscribe(g=>{e(3,l=g),X()}),document.addEventListener("keydown",function(g){if(!_){switch(console.log(g.key),g.key){case"ArrowLeft":O.moveLeft(b);break;case"ArrowRight":O.moveRight(b);break;case"ArrowDown":H();break;case"ArrowUp":O.rotate(b);break;case"z":O.moveBottom(b),H();break;case"x":O.reverseRotate(b);break}B()}}),f&&clearInterval(f),f=setInterval(H,s)}Le(async()=>{try{const y=await(await fetch("/api/leaderBoard",{method:"POST"})).json();e(5,P=y),console.log("리더보드 호출 성공:",y)}catch(i){console.error("리더보드 호출 중 오류 발생:",i)}}),Ue(()=>{V()});function Z(i){Oe[i?"unshift":"push"](()=>{a=i,e(0,a)})}function J(i){Oe[i?"unshift":"push"](()=>{h=i,e(1,h)})}function ie(){C=this.value,e(8,C)}return[a,h,r,l,n,P,_,m,C,w,ae,V,Z,J,ie]}class st extends He{constructor(t){super(),We(this,t,Ze,Ye,je,{})}}export{st as component};
