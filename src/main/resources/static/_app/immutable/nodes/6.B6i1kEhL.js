var ae=Object.defineProperty;var ne=(o,t,e)=>t in o?ae(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var C=(o,t,e)=>(ne(o,typeof t!="symbol"?t+"":t,e),e);import{s as re,n as Z,r as se,o as oe,e as ce}from"../chunks/scheduler.BCVBOh_d.js";import{S as he,i as fe,e as w,s as N,j as K,q as H,c as _,b as q,d as y,a as P,g as J,k as z,n as b,f as W,l as m,o as X,m as Q,B as $}from"../chunks/index.DTdc6F5z.js";import{w as le}from"../chunks/index.GezKuID8.js";const ue=11,ee=20;class Y{constructor(t){C(this,"x");C(this,"y");C(this,"color");C(this,"shape");C(this,"ctx");C(this,"BLOCKS",[[[0,0,2,0],[0,0,2,0],[0,0,2,0],[0,0,2,0]],[[2,2,2],[0,2,0],[0,0,0]],[[2,0,0],[2,0,0],[2,2,0]],[[0,0,2],[0,0,2],[0,2,2]],[[0,2,2],[0,2,2],[0,0,0]],[[2,2,0],[0,2,2],[0,0,0]],[[0,2,2],[2,2,0],[0,0,0]]]);C(this,"COLORS",["cyan","blue","orange","yellow","green","purple","red"]);this.ctx=t,this.spawn()}randomizeType(t){return Math.floor(Math.random()*t)}spawn(){const t=this.randomizeType(this.COLORS.length);this.color=this.COLORS[t],this.shape=this.BLOCKS[t],this.x=3,this.y=0}draw(){this.ctx.fillStyle=this.color,this.shape.forEach((t,e)=>{t.forEach((l,i)=>{l>0&&this.ctx.fillRect(this.x+i,this.y+e,1,1)})})}collision(t){for(let e=0;e<this.shape.length;e++)for(let l=0;l<this.shape[e].length;l++)if(this.shape[e][l]>0){let i=this.x+l,a=this.y+e;if(i<0||i>=ue||a>=ee)return!0;if(a<ee){let s=t.grid[a][i];if(s!==0&&(typeof s=="object"?s.value:s)>0)return!0}}return!1}moveLeft(t){this.x--,this.collision(t)&&this.x++}moveRight(t){this.x++,this.collision(t)&&this.x--}moveDown(t){return this.y++,this.collision(t)?(this.y--,!0):!1}rotate(t){let e=this.shape.map(s=>[...s]),l=e.length;for(let s=0;s<l;s++)for(let h=0;h<s;h++)[e[h][s],e[s][h]]=[e[s][h],e[h][s]];e.forEach(s=>s.reverse());let i=this.x,a=this.y;if(this.shape=e,this.collision(t)){this.shape=e.map(s=>[...s]).reverse().map(s=>s.reverse());for(let s=0;s<l;s++)for(let h=0;h<l/2;h++)[this.shape[s][h],this.shape[s][l-1-h]]=[this.shape[s][l-1-h],this.shape[s][h]];this.x=i,this.y=a}}lock(t){this.shape.forEach((e,l)=>{e.forEach((i,a)=>{i>0&&(t.grid[this.y+l][this.x+a]={value:i,color:this.color})})})}}let M=le(0),U=le(1);function te(o){let t,e,l,i,a="점수 제출",s,h;return{c(){t=w("div"),e=w("input"),l=N(),i=w("button"),i.textContent=a,this.h()},l(k){t=_(k,"DIV",{class:!0});var d=q(t);e=_(d,"INPUT",{placeholder:!0}),l=P(d),i=_(d,"BUTTON",{class:!0,"data-svelte-h":!0}),J(i)!=="svelte-bny16c"&&(i.textContent=a),d.forEach(y),this.h()},h(){b(e,"placeholder","닉네임 입력"),b(i,"class","svelte-1qkdknl"),b(t,"class","modal svelte-1qkdknl")},m(k,d){W(k,t,d),m(t,e),$(e,o[3]),m(t,l),m(t,i),s||(h=[X(e,"input",o[9]),X(i,"click",o[5])],s=!0)},p(k,d){d&8&&e.value!==k[3]&&$(e,k[3])},d(k){k&&y(t),s=!1,se(h)}}}function de(o){let t,e,l,i,a,s,h="Start",k,d,V="Stop",p,g,x,E,T,S,j,B,A,O,n,c,u=o[4]&&te(o);return{c(){t=w("div"),e=w("div"),l=w("canvas"),i=N(),a=w("div"),s=w("button"),s.textContent=h,k=N(),d=w("button"),d.textContent=V,p=N(),g=w("p"),x=K("점수: "),E=K(o[1]),T=N(),S=w("p"),j=K("레벨: "),B=K(o[2]),A=N(),u&&u.c(),O=H(),this.h()},l(r){t=_(r,"DIV",{class:!0});var v=q(t);e=_(v,"DIV",{class:!0});var D=q(e);l=_(D,"CANVAS",{class:!0}),q(l).forEach(y),D.forEach(y),i=P(v),a=_(v,"DIV",{class:!0});var f=q(a);s=_(f,"BUTTON",{class:!0,"data-svelte-h":!0}),J(s)!=="svelte-1ofsci"&&(s.textContent=h),k=P(f),d=_(f,"BUTTON",{class:!0,"data-svelte-h":!0}),J(d)!=="svelte-v5vx3a"&&(d.textContent=V),p=P(f),g=_(f,"P",{class:!0});var R=q(g);x=z(R,"점수: "),E=z(R,o[1]),R.forEach(y),T=P(f),S=_(f,"P",{class:!0});var I=q(S);j=z(I,"레벨: "),B=z(I,o[2]),I.forEach(y),f.forEach(y),v.forEach(y),A=P(r),u&&u.l(r),O=H(),this.h()},h(){b(l,"class","play-board svelte-1qkdknl"),b(e,"class","play-division svelte-1qkdknl"),b(s,"class","svelte-1qkdknl"),b(d,"class","svelte-1qkdknl"),b(g,"class","svelte-1qkdknl"),b(S,"class","svelte-1qkdknl"),b(a,"class","right-division svelte-1qkdknl"),b(t,"class","board svelte-1qkdknl")},m(r,v){W(r,t,v),m(t,e),m(e,l),o[8](l),m(t,i),m(t,a),m(a,s),m(a,k),m(a,d),m(a,p),m(a,g),m(g,x),m(g,E),m(a,T),m(a,S),m(S,j),m(S,B),W(r,A,v),u&&u.m(r,v),W(r,O,v),n||(c=[X(s,"click",o[7]),X(d,"click",o[6])],n=!0)},p(r,[v]){v&2&&Q(E,r[1]),v&4&&Q(B,r[2]),r[4]?u?u.p(r,v):(u=te(r),u.c(),u.m(O.parentNode,O)):u&&(u.d(1),u=null)},i:Z,o:Z,d(r){r&&(y(t),y(A),y(O)),o[8](null),u&&u.d(r),n=!1,se(c)}}}const F=11,G=20,L=35;function pe(o,t){fetch("/api/score",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({nickname:o,score:t})}).then(e=>{if(!e.ok)throw new Error("점수 제출 실패");return e.json()}).then(e=>{console.log("점수 제출 성공:",e)}).catch(e=>{console.error("점수 제출 중 오류 발생:",e)})}function ve(o,t,e){let l,i,a,s=1e3,h=0;M.subscribe(n=>e(1,i=n));function k(n){M.update(c=>c+n)}function d(n){h+=n,h>=10&&(h-=10,U.update(c=>c+1))}class V{constructor(){C(this,"grid");this.reset()}reset(){this.grid=this.getEmptyBoard()}removeLines(){let c=[];for(let r=0;r<G;r++)this.grid[r].every(D=>D.value>0)&&c.push(r);c.forEach(r=>{this.grid.splice(r,1),this.grid.unshift(Array(F).fill(0))});let u=c.length;return h+=u,d(),c.length*c.length*100}getEmptyBoard(){return Array.from({length:G},()=>Array(F).fill(0))}}let p=new V,g,x="",E=!1;function T(){clearInterval(g),e(4,E=!0),M.set(0),U.set(0)}function S(){if(!x.trim()){alert("닉네임을 입력해야 점수를 제출할 수 있습니다.");return}pe(x,i),e(4,E=!1),e(3,x="")}function j(){l.getContext("2d").clearRect(0,0,l.width,l.height),p.reset(),g&&clearInterval(g),M.set(0),U.set(0)}function B(){p.reset(),M.set(0),U.set(0);const n=l.getContext("2d");n.canvas.width=F*L,n.canvas.height=G*L,n.scale(L,L);let c=new Y(n);if(c.collision(p)){T();return}c.draw();function u(){n.clearRect(0,0,n.canvas.width,n.canvas.height),c.draw(),r(),console.table(p.grid);for(let f=0;f<10;f++)p.grid[0][f]===2&&alert("게임오버")}function r(){p.grid.forEach((f,R)=>{f.forEach((I,ie)=>{typeof I=="object"&&I.value>0&&(n.fillStyle=I.color,n.fillRect(ie,R,1,1))})})}function v(){if(c.moveDown(p)){if(c.lock(p),p.grid[0].some(R=>R!==0)){T();return}c=new Y(n)}c.moveDown(p)&&(c.lock(p),c=new Y(n));const f=p.removeLines();k(f),u()}function D(){clearInterval(g),s=Math.max(200,1e3-a*50),g=setInterval(v,s)}U.subscribe(f=>{e(2,a=f),D()}),document.addEventListener("keydown",function(f){switch(f.key){case"ArrowLeft":c.moveLeft(p);break;case"ArrowRight":c.moveRight(p);break;case"ArrowDown":v();break;case"ArrowUp":c.rotate(p);break}u()}),g&&clearInterval(g),g=setInterval(v,s),oe(()=>{const f=l.getContext("2d");f.canvas.width=F*L,f.canvas.height=G*L,f.scale(L,L)})}function A(n){ce[n?"unshift":"push"](()=>{l=n,e(0,l)})}function O(){x=this.value,e(3,x)}return[l,i,a,x,E,S,j,B,A,O]}class we extends he{constructor(t){super(),fe(this,t,ve,de,re,{})}}export{we as component};
